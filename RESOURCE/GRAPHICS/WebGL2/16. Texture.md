
**Texture**: Shader에 넘길 수 있는 2D 배열 데이터

## Texture 적용 순서

### 1.  Shader로 Textrue Coordinate 전달

```glsl title:'Vertex Shader' hl:2,9
in vec4 a_position;
in vec2 a_texcoord;

uniform mat4 u_matrix;

void main() {
  gl_Position = u_matrix * a_position;
  
  v_texcoord = a_texcoord;
}

```

Fragmen Shader에서 텍스쳐를 참조할 수 있도록 `uniform sampler2D` 선언
정점 쉐이더에서 넘어온 텍스쳐 좌표를 사용할 것이고, 텍스쳐로부터 해당하는 색상값을 찾아내기 위해 ***`texture` 함수***를 호출

```glsl title:'Fragment Shader' hl:2,5 ar:9
#version 300 es
precision highp float;
in vec2 v_texcoord;

uniform sampler2D u_texture;

void main() {
  // call texture function
  outColor = texture(u_texture, v_texcoord);
}
```

#### Texture Coordinate

Texture는 **Texture Coordinate**를 사용해 참조됨 
- Left -> Right = 0.0 -> 1.0
- 첫 줄 -> 마지막 줄 = 0.0 -> 1.0 

첫 줄, 마지막 줄이라는 용어 사용 이유: Texture 공간에서는 **위, 아래의 개념이 없기 때문**
- 데이터의 시작 -> 마지막 = **0.0 -> 1.1**
![[texture-coordinates-diagram.svg|center|400]]

#### Convert to Texture Coordinate

```js title: 
texcoordX = pixelCoordX / (width -1)
texcoordY = pixelCoordY / (height -1)

// example textrure coordi
// 왼쪽 기둥 앞면
 38 / 255,  44 / 255,  // 0.149, 0.172
 38 / 255, 223 / 255,  // 0.149, 0.874
```

- 텍스처 좌표가 **0.0 ~ 1.0 범위 밖의 값**을 가진 다면 텍스처를 **반복**한다.
- `CLAMP_TO_EDGE`를 사용해 특정 방향에 대해 **반복하지 않도록** 설정 가능
- `gl.MIRRORED_REPEAT`: 반복시 텍스처를 Mirror로 설정

---

### 2. Image Load

이미지 로딩은 **비동기적**으로 수행됨.  로딩을 요청하면 브라우져가 다운로드하는데 시간이 소요됨. 해결 방안은 크게 2가지가 있으며 두번째 방법(Shimmer Texture)을 사용하여 연습

1. 다운로드 완료 시점까지 화면 렌더링 **대기** 
2. **Shimmer Texture** 생성

#### Shimmer Texture

`image`가 로드되기 전까지 임시로 1x1 사이즈의 blue 컬러를 채워 넣고, 다운로드가 완료되면 `image`를 텍스쳐에 복사해 넣는다. 

```js title:Shimmer  hl:18,4-13 ar:2,19
var texture = gl.creatTexture();
gl.bindTexture(gl.TEXTURE_2D, texture);

gl.texImage2D(
	gl.TEXTURE_2D,   // target
	0,               // level
	gl.RGBA,         // internalformat
	1,               // width
	1,               // height
	0,               // border
	gl.RGBA,           // format
	gl.UNSIGNED_BYTE,  // type
	new Uint8Array([0, 0, 255, 255])); // rgba- blue color

// load iamge async
var image = new iamge();
image.src = "resource/f-texture.png";
iamge.addEventListener('load', function() {
  gl.bindTexture(gl.TEXTURE_2D, texture);
  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.UNSINGED_BYTE, image);
  gl.generateMipmap(gl.TEXTURE_2D);
});
```


---

## Texture Mapping

![[Pasted image 20250106114150.png]]

![[Pasted image 20250106114206.png]]


#### [[Texture Mipmaps]]

#### Textrue Atlas

 여러 장의 이미지를 하나의 텍스처로 만드는 것
 
##### 장점
 - 텍스처를 한장만 로드, 참조하면 됨 -> 쉐이더가 단순해 짐

![[Pasted image 20240726084401.png]]

---

### UV vs Texture Coordinate

Texture Coordinate는 Texture Coord, texcoods 또는 UV로 줄여쓰기도 함
- vertex Position: `x, y, z, w`
- texture coordianate: `s, t, u, v`  

Texture Wrap Setting: `TEXTURE_WRAP_S`와 `TEXTURE_WRAP_T`를 사용 

> [!NOTE] 
> ==UV== == Texture Coordinate
> 
> 
