## Basic

Spot Lighting을 구현하기 위해서는 위치를 중심으로 빛이 향하는 특정 방향을 정해야한다. 그리고 빛이 향하는 방향마다 그 방향과 우리가 정한 특정 방향과의 내적을 구한 후 임계값을 기준으로 빛을 비출것인지 결정한다.
![[Pasted image 20240807155705.png|center|450]]
![[Pasted image 20240807160823.png | center|350]]

아래와 같은 체크로 조명효과 계산 가능 
```cpp  title:'Spotlight fragment shader' hl:11,12,26,29-36 ar:32-35
#version 300 es
precision highp float;
 
// 정점 셰이더에서 넘어온 값
in vec3 v_normal;
in vec3 v_surfaceToLight;
in vec3 v_surfaceToView;
 
uniform vec4 u_color;
uniform float u_shininess;
uniform vec3 u_lightDirection;
uniform float u_limit;          // 내적 공간에서의 값
 
// 프래그먼트 셰이더에서는 출력값을 선언해야 합니다.
out vec4 outColor;
 
void main() {
  // v_normal은 보간되는 varying 이기 때문에 단위 벡터가 아닙니다.
  // 정규화를 해야 다시 단위 벡터가 됩니다.
  vec3 normal = normalize(v_normal);
 
  vec3 surfaceToLightDirection = normalize(v_surfaceToLight);
  vec3 surfaceToViewDirection = normalize(v_surfaceToView);
  vec3 halfVector = normalize(surfaceToLightDirection + surfaceToViewDirection);
//float light = dot(normal, surfaceToLightDirection);
  float light = 0.0;
  float specular = 0.0;
 
  float dotFromDirection = dot(surfaceToLightDirection,
                               -u_lightDirection);
  if (dotFromDirection >= u_limit) {
    light = dot(normal, surfaceToLightDirection);
    if (light > 0.0) {
      specular = pow(dot(normal, halfVector), u_shininess);
    }
  }
  // 중략 
  
```

![[Pasted image 20240807171704.png|center|450]]
몇 가지 확인할 사항이 있다. 먼저 위 코드에서는 `u_lightDirection`의 방향을 **뒤집었다는 점**이다. uniform 값을 설정하는 시점에 방향을 뒤집어서 전달하는 방법도 있겠지만, `u_reverseLightDirection`, `u_negativeLightDirection`의 네이밍보다 이해하기 좋을 것으로 생각됨.
#### Shader에서 조건문 사용
개인 선호도에 달린 것이긴 하나, 가능하면 **_shader_** 에 조건문을 사용하지 않으려 한다. 그 이유는 실제로는  **_shader_** 에 조건문이 없기 때문.  **_shader_** 내에서 조건문을 사용하게 되면 컴파일러가 코드를 여기저기 **`0`, `1`** 을 곱하는 식으로 확장해 실제로는 조건문이 업는 형태로 바꾼다. 즉 조건문을 사용하면 조합하는 만큼 코드가 길어진다는 뜻이다. 

####  function `step` (_a_, _b_)
- **_b_ >= _a_** 인 경우 return **1.0**  반대의 경우 return **0**

 ```js 
 function step(a, b) {
   if (b >= a) {
       return 1;
   } else {
       return 0;
   }
}
```