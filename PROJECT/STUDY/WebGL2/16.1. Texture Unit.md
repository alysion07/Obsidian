## 텍스처 유닛

WebGL에는 Texture;라는 것이 있습니다. Texture;란 셰이더에 넘길 수 있는 2D 배열 데이터입니다. 셰이더에서는 아래와 같이 **_uniform sampler2D_** 를 선언합니다.

```cpp
uniform sampler2D someTexture;
```

`someTexture`에 대해 어떤 텍스처를 사용할지는 셰이더가 어떻게 알 수 있을까요?

이 대목에서 텍스처 유닛이 등장합니다. 텍스처 유닛은 텍스처에 대한 참조를 가진 **전역 배열**입니다. WebGL이 자바스크립트로 쓰여졌다면 아래와 같은 전역 상태(state)를 가지고 있을겁니다.

```js hl:3
const gl = {
  activeTextureUnit: 0,
  textureUnits: [  // textureUnits is array
{ 
TEXTURE_2D: null, TEXTURE_CUBE_MAP: null, TEXTURE_3D: null, TEXTURE_2D_ARRAY, null, },
    { TEXTURE_2D: null, TEXTURE_CUBE_MAP: null, TEXTURE_3D: null, TEXTURE_2D_ARRAY, null, },
    { TEXTURE_2D: null, TEXTURE_CUBE_MAP: null, TEXTURE_3D: null, TEXTURE_2D_ARRAY, null, },
    { TEXTURE_2D: null, TEXTURE_CUBE_MAP: null, TEXTURE_3D: null, TEXTURE_2D_ARRAY, null, },
    { TEXTURE_2D: null, TEXTURE_CUBE_MAP: null, TEXTURE_3D: null, TEXTURE_2D_ARRAY, null, },
    { TEXTURE_2D: null, TEXTURE_CUBE_MAP: null, TEXTURE_3D: null, TEXTURE_2D_ARRAY, null, },
    { TEXTURE_2D: null, TEXTURE_CUBE_MAP: null, TEXTURE_3D: null, TEXTURE_2D_ARRAY, null, },
    { TEXTURE_2D: null, TEXTURE_CUBE_MAP: null, TEXTURE_3D: null, TEXTURE_2D_ARRAY, null, },
    { TEXTURE_2D: null, TEXTURE_CUBE_MAP: null, TEXTURE_3D: null, TEXTURE_2D_ARRAY, null, },
  ];
}
```

여러분은 텍스처 유닛 배열 중 하나의 _**바인드 포인트**_ 에 텍스처를 할당하게 됩니다. `ourTexture`를 텍스처 유닛 5에 할당해 봅시다.

```js title : 'bind to textureUnit 5' hl:10
// 초기화 시점에
const ourTexture = gl.createTexture();
// 텍스처를 초기화하는 코드를 이 곳에 작성합니다.
 
...
 
// 렌더링 시점에
const indexOfTextureUnit = 5;
gl.activeTexture(gl.TEXTURE0 + indexOfTextureUnit);
gl.bindTexture(gl.TEXTURE_2D, ourTexture);
```

```js title:'tell the shader' 
gl.uniform1i(someTextureUniformLocation, indexOfTextureUnit);
```

`gl.activeTexture`는 **텍스처 유닛의** **배열의 인덱스**를 WebGL의 내부 전역 변수에 설정합니다. 이후 모든 다른 텍스처 관련 함수들은 첫 번째 인자로 `target`을 인자로 받는데, 이는 현재 **텍스처 유닛** **바인드 포인트의 참조**입니다.

## 텍스처 유닛의 최대값

WebGL은 최소 32개의 텍스처 유닛을 지원하게 구현하도록 되어 있습니다. 몇 개를 지원하는지 아래 코드를 사용해 알 수 있습니다.

```js
const maxTextureUnits = gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);'
```

각각은 최소 16개를 지원하도록 되어 있습니다.

말하자면 아래와 같습니다.
```js title:'Max TextureUnit count'
maxTextureUnits = 32
maxVertexShaderTextureUnits = 16
maxFragmentShaderTextureUnits = 32
```

즉, 여러분이 정점 셰이더에서 두 개의 텍스처 유닛을 사용하고 있다면 프래그먼트 셰이더에서 사용할 수 있는 최대 개수는 30개가 됩니다. 왜냐하면 총 최대값이 32이기 때문이죠.