
Reference URL
- [OpenGL Projection Matrix (songho.ca)](https://www.songho.ca/opengl/gl_projectionmatrix.html)
- [LearnOpenGL - Coordinate Systems](https://learnopengl.com/Getting-started/Coordinate-Systems)

# Perspective

- 원근법(Perspective): 멀리 있는 물체는 작게 그려 원근법이 느껴지도록 함.
- `position.xy`를 `position.z`로 나누어 원근법을 표현할 수 있다.
- `z`값이 증가할수록(더 멀어질수록) 더 작게 그려진다.

## fudgeFactor

- `xy`를 나누기 전,  `Z`에 곱해지는 `fudgeFactor`를 추가하면, 주어진 거리에서 물체가 **얼마나 더 작아지는지**를 조정할 수 있음

```js title:'fudgeFactor in Matrix' 
function makeZToWMatrix(fudgeFactor) {
	return [
		1, 0, 0, 0,
		0, 1, 0, 0,
		0, 0, 1, fudgeFactor,
		0, 0, 0, 1,
	];
}
```

## Projection Matrix 

```js title:'perspective' 
var m4 = {
  perspective: function(fieldOfViewInRadians, aspect, near, far) {
  var f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewInRadians);
  var rangeInv = 1.0 / (near - far);
    return [
      f / aspect, 0, 0, 0,
      0, f, 0, 0, 
      0, 0, (near + far) * rangeInv, -1,
      0, 0, near * far * rangeInv * 2, 0
    ];
  }
}
```

```js title:drawScene()
...
  var aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;
  var zNear = 1;
  var zFar = 2000;
  var matrix = m4.perspective(fieldOfViewRadians, aspect, zNear, zFar);
  matrix = m4.translate(matrix, translation[0], translation[1], translation[2]);
   matrix = m4.xRotate(matrix, rotation[0]);
   matrix = m4.yRotate(matrix, rotation[1]);
   matrix = m4.zRotate(matrix, rotation[2]);
   matrix = m4.scale(matrix, scale[0], scale[1], scale[2]);
...
```

## Why did we move the F so far in Z (-360)?

- **절두체**(Frustrum) **내부**(`Near` 와 `far` 사이)에 있는 오브젝트만 보여진다.  
- F를 Origin에 놓고 그리는 경우 아래와 같이 그려진다.
![[Pasted image 20240722164601.png|center|450]]![[Pasted image 20240722164627.png|center|450]]

## Perspective Devide

3D Scene을 2D 화면에 표현할때 원근감을 주기 위해 사용됨. 이 과정을 통해 Perspective Projection Matrix를 적용한 후, Homogeneous Coordinates(동차 좌표계)를 일반 좌표계로 변환한다.  

 - Position(`x`, `y`, `z`)값을 `w` 값으로 나누는 과정
 - 4차원 클립 공간 좌표 `[x, y, z, w]`를 3차원 Normalized Device Coordinates `[x', y', z']`로 변환하는 과정